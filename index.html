<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Course Comparison Tool</title>
   
    <!-- Bootstrap Styling -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- Custom Styling -->
    <link rel="stylesheet" href="css/main.css">

    <!-- JavaScript for D3 and Bootstrap -->
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand">Course Comparison Tool</a>
        </div>
        <div class="collapse navbar-collapse">
          <p class="navbar-text navbar-right">Ba</p>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <select class="form-control" id="class-1">
            <option value='-1'>Choose a course</option>
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-control" id="class-2">
          <option value='-1'>Choose a course</option>
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-control" id="class-3">
          <option value='-1'>Choose a course</option>
          </select>
        </div>
      </div>
    </div>
    <div class="container graph">
    </div>
  </body>
  <script>

var margin = {top: 100, right: 50, bottom: 10, left: 10},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x = d3.scale.ordinal().rangePoints([0, width], 1),
    y = {};

var line = d3.svg.line(),
    axis = d3.svg.axis().orient('left'),
    background,
    foreground;

var c10 = d3.scale.category10();

var svg = d3.select('.graph').append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom)
  .append('g')
    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

d3.csv('data/all_courses.csv', function(error, courses) {

  // Extract the list of dimensions and create a scale for each.
  x.domain(dimensions = d3.keys(courses[0]).filter(function(d) {
    nonfeatures = ['crsabbr','crsno','fname','lname','formtype', 
                   'q23','q24','q25','q26','q27','q28','q29','q30','q31','q32'];
    return nonfeatures.indexOf(d) < 0 && (y[d] = d3.scale.linear()
        .domain([0,5])
        .range([height, 0]));
  }));

  console.log(courses);

  var select1 = d3.select('#class-1');
  var select2 = d3.select('#class-2');
  var select3 = d3.select('#class-3');

  select1
    .on('change', function(d) {
      var value = d3.select(this).property('value');
      updateLine();
    });

  select1.selectAll('option')
    .data(courses)
    .enter()
      .append('option')
      .attr('value', function (d, i) { return i; })
      .text(function (d) { return d.crsabbr + ' ' + d.crsno + ' ' + d.lname; });

  select2
    .on('change', function(d) {
      var value = d3.select(this).property('value');
      updateLine();
    });

  select2.selectAll('option')
    .data(courses)
    .enter()
      .append('option')
      .attr('value', function (d, i) { return i; })
      .text(function (d) { return d.crsabbr + ' ' + d.crsno + ' ' + d.lname; });

  select3
    .on('change', function(d) {
      var value = d3.select(this).property('value');
      updateLine();
    });

  select3.selectAll('option')
    .data(courses)
    .enter()
      .append('option')
      .attr('value', function (d, i) { return i; })
      .text(function (d) { return d.crsabbr + ' ' + d.crsno + ' ' + d.lname; });

  var tooltip = d3.select('body')
    .append('div')
    .style('position', 'absolute')
    .style('z-index', '10')
    .style('visibility', 'hidden');

  // Add a group element for each dimension.
  var g = svg.selectAll('.dimension')
      .data(dimensions)
    .enter().append('g')
      .attr('class', 'dimension')
      .attr('transform', function(d) { return 'translate(' + x(d) + ')'; });

  // Add an axis and title.
  g.append('g')
      .attr('class', 'axis')
      .each(function(d) { 
        d3.select(this).call(axis.scale(y[d]));
        if(d != 'q1') {
          d3.select(this).call(axis.ticks(0)); 
        }
      })
    .append('text')
      .style('text-anchor', 'left')
      .attr('class','labels')
      .attr('x', 0)
      .attr('y', -4)
      .attr('transform', function(d) {
         return 'rotate(-45)'; 
      })
      .text(function(d) { 
        desc = '';
        switch(d) {
          case 'q1':
              desc = 'whole';
              break;
          case 'q2':
              desc = 'content';
              break;
          case 'q3':
              desc = 'contribution';
              break;
          case 'q4':
              desc = 'effectiveness';
              break;
          case 'q5':
              desc = 'organization';
              break;
          case 'q6':
              desc = 'voice';
              break;
          case 'q7':
              desc = 'explanations';
              break;
          case 'q8':
              desc = 'alt. explanations';
              break;
          case 'q9':
              desc = 'examples';
              break;
          case 'q10':
              desc = 'question quality';
              break;
          case 'q11':
              desc = 'knowledge';
              break;
          case 'q12':
              desc = 'enthusiasm';
              break;
          case 'q13':
              desc = 'encouragement';
              break;
          case 'q14':
              desc = 'answers';
              break;
          case 'q15':
              desc = 'extra help';
              break;
          case 'q16':
              desc = 'class time';
              break;
          case 'q17':
              desc = 'interest';
              break;
          case 'q18':
              desc = 'learned';
              break;
          case 'q19':
              desc = 'usefulness';
              break;
          case 'q20':
              desc = 'grading';
              break;
          case 'q21':
              desc = 'reasonable work';
              break;
          case 'q22':
              desc = 'clarity';
              break;
        }
        return desc; 
      });

  function updateLine() {
    var sel1 = +d3.select('#class-1').node().value;
    var sel2 = +d3.select('#class-2').node().value;
    var sel3 = +d3.select('#class-3').node().value;
    classes = [];
    if (sel1 > -1) classes.push(courses[sel1]);
    if (sel2 > -1) classes.push(courses[sel2]);
    if (sel3 > -1) classes.push(courses[sel3]);

    console.log(classes);

    svg.selectAll('.foreground').remove();

    // Add blue foreground lines for focus.
    svg.append('g')
        .attr('class', 'foreground')
      .selectAll('path')
        .data(classes)
      .enter().append('path')
        .attr('d', path)
        .style('stroke', function(d, i) { return c10(i); })
        .on('mouseover', function(d){
          return tooltip
            .style('visibility', 'visible')
            .text(d.crsabbr + ' ' + d.crsno + ' ' + d.lname);
          })
        .on('mousemove', function(){
          return tooltip
            .style('top', (event.pageY-10)+'px').style('left',(event.pageX+10)+'px');
          })
        .on('mouseout', function(){return tooltip.style('visibility', 'hidden');
      });
  }

});

// Returns the path for a given data point.
function path(d) {
  return line(dimensions.map(function(p) { return [x(p), y[p](d[p])]; }));
}

</script>
</html>